{% extends '::default/index.html.twig' %}
{% block title %}{{ 'media.title' | trans({}, 'media') }}{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/plugins/fineUploader/fine-uploader-gallery.css') }}" rel="stylesheet">
    <style>
            #fine-uploader-s3 .preview-link {
            display: block;
            height: 100%;
            width: 100%;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-sm-4">
            <h2>{{ 'media.title' | trans({}, 'media') }}</h2>
            <ol class="breadcrumb">
                <li>
                    {{ 'MCMBuilder' | trans({}, 'media') }}
                </li>
                <li class="active">
                    <strong>{{ 'media.title' | trans({}, 'media') }}</strong>
                </li>
            </ol>
        </div>
    </div>
    <div class="wrapper wrapper-content animated fadeIn">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">


                    <div class="wrapper wrapper-content">
                        <div class="row">
                            <div class="col-lg-3">
                                <div class="ibox float-e-margins">
                                    <div class="ibox-content">

                                        <div class="file-manager">

                                            <h5>{{ 'Search' | trans({}, 'media') }}</h5>
                                            <form action="{{ path('media_index' ) }}" method="POST">
                                                <div class="form-group">
                                                    <input type="text" id="searchlabel" name="searchlabel" required="required" class="form-control" placeholder="{{ 'Media Label' | trans({}, 'media') }}" />
                                                </div>
                                                <div class="form-group">
                                                    <input type="submit" value="{{ 'Search' | trans({}, 'media') }}" class="btn"/>
                                                </div>
                                            </form>


                                            <div class="hr-line-dashed"></div>
                                            <div class="clearfix"></div>

                                            <div class="clearfix"></div>
                                            <div id="fine-uploader-s3"></div>
                                            <script type="text/template" id="qq-template-s3">
                                                <div class="qq-uploader-selector qq-uploader qq-gallery" qq-drop-area-text="Drop files here">
                                                    <div class="qq-total-progress-bar-container-selector qq-total-progress-bar-container">
                                                        <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-total-progress-bar-selector qq-progress-bar qq-total-progress-bar"></div>
                                                    </div>
                                                    <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
                                                        <span class="qq-upload-drop-area-text-selector"></span>
                                                    </div>
                                                    <div class="qq-upload-button-selector qq-upload-button">
                                                        <div>Upload a file</div>
                                                    </div>
                                                    <span class="qq-drop-processing-selector qq-drop-processing">
                <span>Processing dropped files...</span>
                <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
            </span>
                                                    <ul class="qq-upload-list-selector qq-upload-list" role="region" aria-live="polite" aria-relevant="additions removals">
                                                        <li>
                                                            <span role="status" class="qq-upload-status-text-selector qq-upload-status-text"></span>
                                                            <div class="progress qq-progress-bar-container-selector">
                                                                <div class="bar qq-progress-bar-selector" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                                            </div>
                                                            <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
                                                            <div class="qq-thumbnail-wrapper">
                                                                <a class="preview-link" target="_blank">
                                                                    <img class="qq-thumbnail-selector" qq-max-size="120" qq-server-scale>
                                                                </a>
                                                            </div>
                                                            <button type="button" class="qq-upload-cancel-selector qq-upload-cancel">X</button>
                                                            <button type="button" class="qq-upload-retry-selector qq-upload-retry">
                                                                <span class="qq-btn qq-retry-icon" aria-label="Retry"></span>
                                                                Retry
                                                            </button>

                                                            <div class="qq-file-info">
                                                                <div class="qq-file-name">
                                                                    <span class="qq-upload-file-selector qq-upload-file"></span>
                                                                    <span class="qq-edit-filename-icon-selector qq-edit-filename-icon" aria-label="Edit filename"></span>
                                                                </div>
                                                                <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
                                                                <span class="qq-upload-size-selector qq-upload-size"></span>
                                                                <button type="button" class="qq-btn qq-upload-delete-selector qq-upload-delete">
                                                                    <span class="qq-btn qq-delete-icon" aria-label="Delete"></span>
                                                                </button>
                                                                <button type="button" class="qq-btn qq-upload-pause-selector qq-upload-pause">
                                                                    <span class="qq-btn qq-pause-icon" aria-label="Pause"></span>
                                                                </button>
                                                                <button type="button" class="qq-btn qq-upload-continue-selector qq-upload-continue">
                                                                    <span class="qq-btn qq-continue-icon" aria-label="Continue"></span>
                                                                </button>
                                                            </div>
                                                        </li>
                                                    </ul>

                                                    <dialog class="qq-alert-dialog-selector">
                                                        <div class="qq-dialog-message-selector"></div>
                                                        <div class="qq-dialog-buttons">
                                                            <button type="button" class="qq-cancel-button-selector">Close</button>
                                                        </div>
                                                    </dialog>

                                                    <dialog class="qq-confirm-dialog-selector">
                                                        <div class="qq-dialog-message-selector"></div>
                                                        <div class="qq-dialog-buttons">
                                                            <button type="button" class="qq-cancel-button-selector">No</button>
                                                            <button type="button" class="qq-ok-button-selector">Yes</button>
                                                        </div>
                                                    </dialog>

                                                    <dialog class="qq-prompt-dialog-selector">
                                                        <div class="qq-dialog-message-selector"></div>
                                                        <input type="text">
                                                        <div class="qq-dialog-buttons">
                                                            <button type="button" class="qq-cancel-button-selector">Cancel</button>
                                                            <button type="button" class="qq-ok-button-selector">Ok</button>
                                                        </div>
                                                    </dialog>
                                                </div>
                                            </script>
                                            <div class="hr-line-dashed"></div>
                                            <div class="clearfix"></div>

                                            <div class="col-sm-12">
                                               <div class="col-sm-12">
                                                    <h5>{{ 'TAGS' | trans({}, 'media') }}</h5>
                                                    <ul class="folder-list" style="padding: 0">
                                                        <li><a href="{{ path('media_index' ) }}"><i class="fa fa-folder"></i> {{ 'All' | trans({}, 'media') }}</a></li>
                                                        <li><a href="{{ path('media_index_type',{'type': 'image','prod': prod} ) }}"><i class="fa fa-folder"></i> {{ 'Images' | trans({}, 'media') }}</a></li>
                                                        <li><a href="{{ path('media_index_type',{'type': 'video','prod': prod} ) }}"><i class="fa fa-folder"></i> {{ 'Videos' | trans({}, 'media') }}</a></li>
                                                        <li><a href="{{ path('media_index_type',{'type': 'pdf'  ,'prod': prod} ) }}"><i class="fa fa-folder"></i> {{ 'PDF' | trans({}, 'media') }}</a></li>
                                                        <li><a href="{{ path('media_index_type',{'type': 'me'  ,'prod': prod} ) }}"><i class="fa fa-folder"></i> {{ 'My media' | trans({}, 'media') }}</a></li>
                                                    </ul>
                                                </div>
                                                {#

                                                <div class="col-sm-6">
                                                    <h5>Product</h5>
                                                    <ul class="folder-list" style="padding: 0">
                                                        <li><a href="{{ path('media_index' ) }}"><i class="fa fa-folder"></i> All</a></li>
                                                        {% for product in products %}
                                                            <li><a href="{{ path('media_index_type',{'type': type|default('null'),'prod': product.id} ) }}"><i class="fa fa-folder"></i> {{ product.name }}</a></li>

                                                        {% endfor %}
                                                    </ul>
                                                </div>

                                                #}
                                            </div>
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-9 animated fadeInRight">
                                <div class="row">
                                    <div class="col-lg-12">

                                        {% for media in image %}
                                            <div class="file-box removeMedia-{{ media.id }}">
                                                <div class="file">
                                                    <a href="#presentation-{{ media.id }}" data-toggle="modal" data-target="#PresentationModalImage-{{ media.id }}">
                                                        <span class="corner"></span>

                                                            <div class="image thumbnail-img">
                                                                <img alt="image" class="img-thumbed" src="{{ media.thumbUrl }}">
                                                            </div>
                                                        <div  class="file-name mediaMytitle" align="center">
                                                           <span>   {{ media.title }}   </span>
                                                            <br>

                                                            <a class="btn btn-white btn-pencil media-remove" data-type="img" data-flag="{{ media.flag }}" data-href="{{ path('remove_media_ajax',{type:'img'}) }}" data-id="{{ media.id }}">
                                                                <i class="fa fa-trash"></i>
                                                            </a>
                                                            {% if  is_granted('ROLE_ADMIN') or is_granted('ROLE_MANAGER') %}
                                                            <a class="btn btn-white btn-bitbucket" data-toggle="modal" data-target="#UpdatePresentationModalimg-{{ media.id }}" data-id="">
                                                                <i class="fa fa-pencil"></i>
                                                            </a>
                                                            {% endif %}
                                                            <a class="btn btn-white btn-bitbucket" data-toggle="modal" data-target="#PresentationModalImage-{{ media.id }}">
                                                                <i class="fa fa-eye"></i>
                                                            </a>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>

                                            <div class="modal inmodal" id="PresentationModalImage-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div style="width: 70%;" class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div id="modal-medias" class="modal-header">
                                                            <button type="button" class="close img-close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>

                                                            <div class="col-lg-9 border-right">
                                                                    <img width="100%" src="{{ media.url }}">
                                                            </div>
                                                            <div class="col-lg-4 " align="left" >
                                                                <b>{{ 'media.detail' | trans({}, 'media') }}</b><br>
                                                               <div class="title-large"> {{ 'media.detail_title' | trans({}, 'media') }}: {{ media.title }}</div><br>
                                                               <span>{{ 'media.detail_format' | trans({}, 'media') }}: {{ media.contenttype|replace({'image/': ''})|upper }}</span><br>
                                                              <span>  {{ 'media.detail_size' | trans({}, 'media') }}:  {{ (media.size /100000) |round(2, 'floor') }} M </span><br>
                                                                <span>{{ 'media.detail_resolution' | trans({}, 'media') }}: {{ media.width }} × {{ media.height }} </span><br>
                                                                <span> {{ 'media.detail_creation_date' | trans({}, 'media') }}: {{ media.created |date('Y-m-d') }} </span><br>
                                                                <span>{{ 'media.detail_update_date' | trans({}, 'media') }}: {{ media.updated |date('Y-m-d') }}</span><br>
                                                                <!--
                                                                <b>{{ media.labelmedia }}</b><br>
                                                                {{ media.height}} x {{ media.width}}</b>
-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!----      Modale de modification    -------------------->
                                            <div class="modal inmodal" id="UpdatePresentationModalimg-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>

                                                            <div class="col-lg-6 border-right">

                                                                    <img width="100%" src="{{ media.url }}">

                                                            </div>
                                                            <div class="col-lg-6 " align="left">

                                                                <form  method="post" action="{{ path('update_media',{id:media.id,type:'img'}) }}" enctype="multipart/form-data">

                                                                    <div class="form-group">
                                                                        <label for="fos_user_registration_form_firstname" class="required">{{ 'media.detail_title' | trans({}, 'media') }}</label>* :

                                                                        <input type="text" class="form-control" value="{{ media.title }}" name="title"/>
                                                                    </div>
                                                                    <br>
                                                                    <div class="form-group">
                                                                        <input type="submit"class="btn btn-success pull-right" value="Save" />
                                                                        <a type="submit" data-type="img"
                                                                                         data-flag="{{ media.flag }}"
                                                                                         data-key="{{ media.key }}"
                                                                                         data-bucket = "{{ media.bucketName }}"
                                                                                         data-id="{{ media.id }}"
                                                                           style="background-color: rgb(190, 92, 73); border-color:rgb(190, 92, 73)" class="media-replace btn btn-success"/>{{ 'Replace Image' | trans({}, 'media') }}</a>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!----      Modale de remplacement    -------------------->
                                            <div style="z-index: 999999999" class="modal inmodal" id="ReplaceModalimg{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                                        </div>
                                                        <div>
                                                                <div id="my-awesome-dropzone-img{{ media.id }}" data-id="{{ media.id }}"></div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}




                                        {% for media in pdf %}
                                            <div class="file-box removeMedia-{{ media.id }}">
                                                <div class="file">
                                                    <a href="#presentation-{{ media.id }}" data-toggle="modal" data-target="#PresentationModalPicturePdf-{{ media.id }}">
                                                        <span class="corner"></span>
                                                            <div class="image">
                                                                <a class="btn btn-white btn-bitbucket addModal"
                                                                   data-toggle="modal"
                                                                   data-target="#PresentationModalPdf-{{ media.id }}"
                                                                   data-url="{{ media.url }}" data-id="{{ media.id }}">
                                                                    <img alt="{{ media.url }}"
                                                                         class="img-responsive" src="{{ asset('img/pdf.png') }}">
                                                                </a>
                                                            </div>
                                                        <div  class="file-name mediaMytitle" align="center">
                                                        <span>  {{ media.title }} </span>
                                                            <br><a class="btn btn-white btn-pencil media-remove" data-type="pdf" data-flag="{{ media.flag }}" data-href="{{ path('remove_media_ajax',{type:'pdf'}) }}" data-id="{{ media.id }}">
                                                                <i class="fa fa-trash"></i>
                                                            </a>
                                                            {% if  is_granted('ROLE_ADMIN') or is_granted('ROLE_MANAGER') %}
                                                            <a class="btn btn-white btn-bitbucket" data-toggle="modal" data-target="#UpdatePresentationModalpdf-{{ media.id }}" data-id="">
                                                                <i class="fa fa-pencil"></i>
                                                            </a>
                                                            {% endif %}
                                                            <a class="btn btn-white btn-bitbucket addModal"
                                                               data-toggle="modal"
                                                               data-target="#PresentationModalPdf-{{ media.id }}"
                                                               data-url="{{ media.url }}" data-id="{{ media.id }}">
                                                                <i class="fa fa-eye"></i>
                                                            </a>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>

                                            <div class="modal inmodal" id="PresentationModalPicturePdf-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>
                                                            {% if 'application/pdf' == media.contentType %}
                                                                <img width="100%" src="{{ asset('img/pdf.png') }}">
                                                            {% else %}
                                                                {#<img width="100%" src="{{ path('token=pdf',{id: media.id} ) }}">#}
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal inmodal" id="PresentationModalPdf-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>

                                                            <div class="col-lg-9 border-right" id="object-{{ media.id }}">

                                                            </div>
                                                            <div class="col-lg-3 " align="left">
                                                                <b>{{ 'media.detail' | trans({}, 'media') }}</b><br>
                                                                {{ 'media.detail_title' | trans({}, 'media') }}: {{ media.title }}<br>
                                                                {{ 'media.detail_format' | trans({}, 'media') }}: PDF<br>
                                                                {{ 'media.detail_size' | trans({}, 'media') }}:  {{ (media.size /1000000) |round(2, 'floor') }} M<br>
                                                                {{ 'media.detail_creation_date' | trans({}, 'media') }}: {{ media.created |date('Y-m-d') }}<br>
                                                                {{ 'media.detail_update_date' | trans({}, 'media') }}: {{ media.updated |date('Y-m-d') }}<br>
                                                                <!--
                                                                <b>{{ media.labelmedia }}</b><br>
                                                                {{ media.height}} x {{ media.width}}</b>
-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                           <!----      Modale de modification    -------------------->
                                            <div class="modal inmodal" id="UpdatePresentationModalpdf-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>

                                                            <div class="col-lg-6 border-right">
                                                                <img width="100%" src="{{ asset('img/pdf.png') }}">
                                                            </div>
                                                            <div class="col-lg-6 " align="left">

                                                                <form  method="post" action="{{ path('update_media',{id:media.id,type:'pdf'}) }}" enctype="multipart/form-data">

                                                                    <div class="form-group">
                                                                        <label for="fos_user_registration_form_firstname" class="required">{{ 'media.detail_title' | trans({}, 'media') }}</label>* :

                                                                        <input type="text"class="form-control" value="{{ media.title }}" name="title"/>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <input type="submit"class="btn btn-success pull-right" value="Save" />
                                                                        <a type="submit" data-type="pdf"
                                                                           data-flag="{{ media.flag }}"
                                                                           data-key="{{ media.key }}"
                                                                           data-bucket = "{{ media.bucketName }}"
                                                                           data-id="{{ media.id }}"
                                                                           style="background-color: rgb(190, 92, 73); border-color:rgb(190, 92, 73)" class="media-replace btn btn-success"/>{{ 'Replace PDF' | trans({}, 'media') }}</a>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!----      Modale de remplacement    -------------------->
                                            <div style="z-index: 999999999" class="modal inmodal" id="ReplaceModalpdf{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>
                                                        </div>
                                                        <div>
                                                            <div id="my-awesome-dropzone-img{{ media.id }}" data-id="{{ media.id }}"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}






                                        {% for media in video %}
                                            <div class="file-box removeMedia-{{ media.id }}">
                                                <div class="file">
                                                    <a href="#presentation-{{ media.id }}" data-toggle="modal" data-target="#PresentationModalPictureVideo-{{ media.id }}">
                                                        <span class="corner"></span>
                                                            <div class="image">
                                                                <img alt="image" class="img-responsive" src="{{ asset('img/video.png') }}">
                                                            </div>
                                                        <div  class="file-name" align="center">
                                                            <br><a class="btn btn-white btn-pencil media-remove" data-type="video" data-flag="{{ media.flag }}" data-href="{{ path('remove_media_ajax',{type:'video'}) }}" data-id="{{ media.id }}">
                                                                <i class="fa fa-trash"></i>
                                                            </a>
                                                            {% if  is_granted('ROLE_ADMIN') or is_granted('ROLE_MANAGER') %}
                                                            <a class="btn btn-white btn-bitbucket" data-toggle="modal" data-target="#UpdatePresentationModalvideo-{{ media.id }}" data-id="">
                                                                <i class="fa fa-pencil"></i>
                                                            </a>
                                                            {% endif %}
                                                            <a class="btn btn-white btn-bitbucket addVideo"
                                                               data-type = 'video'
                                                               data-toggle="modal"
                                                               data-target="#PresentationModalVideo-{{ media.id }}"
                                                               data-url="{{ media.url }}"
                                                               data-id="{{ media.id }}">
                                                                <i class="fa fa-eye"></i>
                                                            </a>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>

                                            <div class="modal inmodal" id="PresentationModalPictureVideo-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>
                                                                <video width="320" height="240" controls>
                                                                    <source src="{{ media.url }}" type="video/mp4">
                                                                </video>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal inmodal" id="PresentationModalVideo-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>



                                                            <div class="col-lg-9 border-right" id="object-{{ media.id }}">

                                                            </div>
                                                            <div class="col-lg-4" align="left">
                                                                <b>{{ 'media.detail' | trans({}, 'media') }}</b><br>
                                                                {{ 'media.detail_title' | trans({}, 'media') }}: {{ media.title }}<br>
                                                                {{ 'media.detail_format' | trans({}, 'media') }}: Video<br>
                                                                {{ 'media.detail_size' | trans({}, 'media') }}:  {{ (media.size /100000) |round(2, 'floor') }} M<br>
                                                                {{ 'media.detail_resolution' | trans({}, 'media') }}: {{ media.width }} × {{ media.height }}<br><br>
                                                                {{ 'media.detail_creation_date' | trans({}, 'media') }}: {{ media.created |date('Y-m-d') }}<br>
                                                                {{ 'media.detail_update_date' | trans({}, 'media') }}: {{ media.updated |date('Y-m-d') }}<br>
                                                                <!--
                                                                <b>{{ media.labelmedia }}</b><br>
                                                                {{ media.height}} x {{ media.width}}</b>
-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!----      Modale de modification    -------------------->
                                            <div class="modal inmodal" id="UpdatePresentationModalvideo-{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>

                                                            <div class="col-lg-6 border-right">
                                                                    <img width="100%" src="{{ asset('img/video.png') }}">

                                                            </div>
                                                            <div class="col-lg-6 " align="left">

                                                                <form  method="post" action="{{ path('update_media',{id:media.id,type:'video'}) }}" enctype="multipart/form-data">

                                                                    <div class="form-group">
                                                                        <label for="fos_user_registration_form_firstname" class="required">{{ 'media.detail_title' | trans({}, 'media') }}</label>* :

                                                                        <input type="text"class="form-control" value="{{ media.title }}" name="title"/>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <input type="submit"class="btn btn-success pull-right" value="Save" />
                                                                        <a type="submit" data-type="video"
                                                                           data-flag="{{ media.flag }}" data-id="{{ media.id }}"
                                                                           data-key="{{ media.key }}"
                                                                           data-bucket = "{{ media.bucketName }}" style="background-color: rgb(190, 92, 73); border-color:rgb(190, 92, 73)" class="media-replace btn btn-success"/>{{ 'Replace Video' | trans({}, 'media') }}</a>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!----      Modale de remplacement    -------------------->
                                            <div style="z-index: 999999999" class="modal inmodal" id="ReplaceModalvideo{{ media.id }}" tabindex="-1" role="dialog"  aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content animated fadeIn">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>
                                                        </div>
                                                        <div>
                                                            <div id="my-awesome-dropzone-img{{ media.id }}" data-id="{{ media.id }}"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}


                                        <div class="modal inmodal" id="addMedia" tabindex="-1" role="dialog"  aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content animated fadeIn">
                                                    <button type="button" class="close cancelMediaAdd" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'Close' | trans({}, 'media') }}</span></button>
                                                    <div class="modal-header">

                                                        <div class="form-group">
                                                            <label for="title" class="required">{{ 'media.add_new_media_title' | trans({}, 'media') }}</label> :
                                                            <input type="text" class="form-control" id="addMediaTitle">
                                                            </input>
                                                        </div>
                                                        {#  <div class="form-group">
                                                             <label for="project" class="required">{{ 'media.add_new_media_projects' | trans({}, 'media') }}</label>* :
                                                             <select class="form-control" id="addMediaProject">
                                                                {% for p in projects %}
                                                                 <option value="{{ p.id }}">{{ p.name }}</option>
                                                                {%  endfor %}
                                                             </select>
                                                         </div>
                                                         <div class="form-group">
                                                             <label for="presentation" class="required">{{ 'media.add_new_media_presentation' | trans({}, 'media') }}</label>* :
                                                             <select class="form-control" id="addMediaPresentation">
                                                             </select>
                                                         </div>--> #}
                                                        <div class="form-group">
                                                            <input type="button" value="{{ 'media.add_new_media_submit' | trans({}, 'media') }}" class="btn btn-success" id="sendMedia">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

    {% block javascripts %}
        {{ parent () }}
        <!-- DROPZONE -->
        {{ pdf_size }}
        <script>
            TWIG.urlGetPres = "{{ path('getPresByMediaAction') }}";
            TWIG.urlgetproject = "{{ path('get_presentationByProject') }}";
            TWIG.pdf_size= "{{ pdf_size }}";
            TWIG.image_size = "{{ image_size }}";
            TWIG.video_size = "{{ video_size }}";
            TWIG.file_extensions = "{{ file_extension }}";
            TWIG.size_message = "{{ 'media.file_size_message' | trans({'%pdf_size%': pdf_size, '%image_size%':image_size, '%video_size%':video_size}, 'media') }}";
            TWIG.delete_file_message = "{{ 'media.delete_file_message' | trans({}, 'media') }}";
            TWIG.delete_file_message_yes = "{{ 'media.delete_file_message_yes' | trans({}, 'media') }}";
            TWIG.delete_file_message_no = "{{ 'media.delete_file_message_no' | trans({}, 'media') }}";
            TWIG.endPointSignature = "{{ path('s3_signature') }}";
            TWIG.endPointSuccess = "{{ path('s3_signature',{'success':'success'}) }}";
            TWIG.endPointRemove = "{{ path('s3_signature') }}";
            TWIG.notAvailablePath = "{{ asset('img/placeholders/not_available-generic.png') }}";
            TWIG.waitingPath = "{{ asset('img/placeholders/waiting-generic.png') }}";
            TWIG.replaceMsg = "{{ 'media.replace_file_message' | trans({}, 'media')}}";
            TWIG.companyParentName = "{{ companyParentName }}";
        </script>
        {#<script src="{{ asset('js/mclmbuilder_scripts/upload-media.js') }}"></script>#}
        <script src="{{ asset('js/mclmbuilder_scripts/replace-media.js') }}"></script>
        <script src="{{ asset('js/mclmbuilder_scripts/pdfFile.js') }}"></script>
        <script src="{{ asset('js/plugins/fineUploader/s3.fine-uploader.js') }}"></script>
        <script src="{{ asset('js/plugins/toastr/toastr.min.js') }}"></script>
        <script src="{{ asset('js/build/envconf.js') }}"></script>

        <script>
            toastr.options = {
                closeButton: true,
                progressBar: true,
                showMethod: 'slideDown',
                preventDuplicates: true,
                timeOut: 1500
            };
            var s3Uploader = new qq.s3.FineUploader({
                debug: true,
                element: document.getElementById('fine-uploader-s3'),
                template: 'qq-template-s3',
                multiple: false,
                request: {
                    endpoint: TWIG.awsConf.ENV_BUCKET + ".s3.amazonaws.com",
                    accessKey: TWIG.awsConf.awsUsersList.Argolife[0].admin.id
                },
                signature: {
                    endpoint: "{{ path('s3_signature') }}"
                },
                uploadSuccess: {
                    endpoint: "{{ path('s3_signature',{'success':'success'}) }}",
                    params: {
                        isBrowserPreviewCapable: qq.supportedFeatures.imagePreviews
                    }
                },
                iframeSupport: {
                    localBlankPagePath: "/success.html"
                },
                cors: {
                    expected: true
                },
                chunking: {
                    enabled: true
                },
                resume: {
                    enabled: true
                },
                deleteFile: {
                    enabled: true,
                    method: "DELETE",
                    endpoint: "{{ path('s3_signature') }}"
                },
                thumbnails: {
                    placeholders: {
                        notAvailablePath: "{{ asset('img/placeholders/not_available-generic.png') }}",
                        waitingPath: "{{ asset('img/placeholders/waiting-generic.png') }}"
                    }
                },
                objectProperties: {
                    acl: "public-read",
                    key: function (fileId) {
                        var filename = s3Uploader.getName(fileId);
                        var ext = filename.substr(filename.lastIndexOf('.') + 1);
                        var basename = filename.replace('.' + ext, '');
                       // var folder = 'web_uploads/{{ userCompany }}/';
                        var folder_name = '';
                        switch(ext) {
                            case 'pdf':
                               // folder_name = folder + 'pdf/';
                                folder_name = TWIG.companyParentName + '/pdf/';
                                break;
                            case 'mp4':
                              //  folder_name = folder + 'video/';
                                folder_name = TWIG.companyParentName + '/video/';
                                break;
                            default:
                               // folder_name = folder + 'image/';
                                folder_name = TWIG.companyParentName + '/image/';
                        }
                        var time = new Date().getTime();
                        var files3 =  basename + '_' + time + '.' + ext;
                        s3Uploader.setName(fileId, files3);
                        return folder_name  + basename + '_' + time + '.' + ext;
                    }
                },
                callbacks: {
                    onComplete: function(id, name, response) {
                        var file = s3Uploader.getFile(id);
                        var imageWidth  = "";
                        var imageHeight = "";
                        var thumbUrl    = "";
                        var url1024    = "";
                        var resize      = false;
                        var path        = "{{ path('medias_new_aws') }}";
                        var idMedia     = "";
                        var previewLink = qq(this.getItemByFileId(id)).getByClass('preview-link')[0];
                        if (response.success) {
                            previewLink.setAttribute("href", response.url);
                            $(previewLink).find('img').attr('src', response.url);
                            if (file.type.match(/image.*/) !== null) {
                                var theImage     = new Image();
                                var widthCompare = TWIG.awsConf.widthCompare;
                                theImage.src     = response.url;
                                theImage.onload  = function () {
                                    imageWidth   = theImage.width;
                                    imageHeight  = theImage.height;
                                    if (imageWidth > widthCompare) {
                                        thumbUrl = "https://s3-eu-west-1.amazonaws.com/mcm-media-resize/thumb_media/" + s3Uploader.getName(id);
                                        url1024  = "https://s3-eu-west-1.amazonaws.com/mcm-media-resize/1024xnull/"   + s3Uploader.getName(id);
                                        resize   = true;
                                    }
                                    getModalForImage(
                                        name,
                                        response.url,
                                        s3Uploader.getSize(id),
                                        file.type,
                                        s3Uploader.getBucket(id),
                                        s3Uploader.getKey(id),
                                        imageWidth,
                                        imageHeight,
                                        resize,
                                        thumbUrl,
                                        url1024,
                                        path,
                                        idMedia,
                                        'add'
                                    );

                                };
                            } else {

                                getModalForImage(
                                    name,
                                    response.url,
                                    s3Uploader.getSize(id),
                                    file.type,
                                    s3Uploader.getBucket(id),
                                    s3Uploader.getKey(id),
                                    imageWidth,
                                    imageHeight,
                                    resize,
                                    thumbUrl,
                                    url1024,
                                    path,
                                    idMedia,
                                    'add'
                                );
                            }
                        }

                    },
                    onError: function(id, name, errorReason, xhrOrXdr) {
                        toastr.error(qq.format("Error on file number {} - {}.  Reason: {}", id, name, errorReason));
                    }

                },
                validation: {
                    allowedExtensions: ['jpeg', 'jpg', 'png', 'pdf', 'mp4'],
                    sizeLimit: TWIG.awsConf.sizeLimit
                },
                scaling: {
                    /*sizes: [
                        {name: "small", maxSize: 100},
                        {name: "medium", maxSize: 300}
                    ]*/
                }

            });
            $(document).on('click', '.media-replace', function () {
                var type        = $(this).attr('data-type');
                var idMedia     = $(this).attr('data-id');
                var mediaKey    = $(this).attr('data-key');
                $("#UpdatePresentationModal"+type+"-"+idMedia).modal("hide");
                var allowedExt  = [];
                switch(type) {
                    case 'img':
                        allowedExt = ['jpeg', 'jpg', 'png'];
                        break;
                    case 'pdf':
                        allowedExt = ['pdf'];
                        break;
                    case 'video':
                        allowedExt = ['mp4'];
                        break;
                }
                var s3Uploader2 = new qq.s3.FineUploader({
                    debug   : true,
                    element : document.getElementById('my-awesome-dropzone-img'+idMedia),
                    template: 'qq-template-s3',
                    multiple: false,
                    request : {
                        endpoint :  TWIG.awsConf.ENV_BUCKET + ".s3.amazonaws.com",
                        accessKey: TWIG.awsConf.awsUsersList.Argolife[0].admin.id
                    },
                    signature: {
                        endpoint: "{{ path('s3_signature') }}"
                    },
                    uploadSuccess: {
                        endpoint: "{{ path('s3_signature',{'success':'success'}) }}",
                        params  : {
                            isBrowserPreviewCapable: qq.supportedFeatures.imagePreviews
                        }
                    },
                    iframeSupport: {
                        localBlankPagePath: "/success.html"
                    },
                    cors: {
                        expected: true
                    },
                    chunking: {
                        enabled: true
                    },
                    resume: {
                        enabled: true
                    },
                    deleteFile: {
                        enabled: true,
                        method: "DELETE",
                        endpoint: "{{ path('s3_signature') }}"
                    },
                    thumbnails: {
                        placeholders: {
                            notAvailablePath: "{{ asset('img/placeholders/not_available-generic.png') }}",
                            waitingPath: "{{ asset('img/placeholders/waiting-generic.png') }}"
                        }
                    },
                    objectProperties: {
                        acl: "public-read",
                        key: function (fileId) {
                            return mediaKey;
                        }
                    },
                    callbacks: {
                        onComplete: function (id, name, response) {
                            var file = s3Uploader2.getFile(id);
                            var d = new Date();
                            var imageWidth = "";
                            var imageHeight = "";
                            var thumbUrl = "";
                            var url1024      = "";
                            var resize = false;
                            var path   = "{{ path('replace_Media_s3') }}";
                            if (response.success) {
                                if (file.type.match(/image.*/) !== null) {
                                    var theImage     = new Image();
                                    var widthCompare = 1024;
                                    theImage.src     = response.url + '?ver=' + d.getTime();
                                    theImage.onload  = function () {
                                        imageWidth   = theImage.width;
                                        imageHeight  = theImage.height;
                                        if (imageWidth > widthCompare) {
                                            thumbUrl = "https://s3-eu-west-1.amazonaws.com/mcm-media-resize/thumb_media/"+s3Uploader.getName(id);
                                            url1024  = "https://s3-eu-west-1.amazonaws.com/mcm-media-resize/1024xnull/"+s3Uploader.getName(id);
                                            resize   = true;
                                        }
                                        getModalForImage(
                                            name,
                                            response.url,
                                            s3Uploader2.getSize(id),
                                            file.type,
                                            s3Uploader2.getBucket(id),
                                            s3Uploader2.getKey(id),
                                            imageWidth,
                                            imageHeight,
                                            resize,
                                            thumbUrl,
                                            url1024,
                                            path,
                                            idMedia,
                                            'replace',
                                            type
                                        );

                                    };
                                } else {

                                    getModalForImage(
                                        name,
                                        response.url,
                                        s3Uploader2.getSize(id),
                                        file.type,
                                        s3Uploader2.getBucket(id),
                                        s3Uploader2.getKey(id),
                                        imageWidth,
                                        imageHeight,
                                        resize,
                                        thumbUrl,
                                        url1024,
                                        path,
                                        idMedia,
                                        'replace',
                                        type
                                    );
                                }
                                s3Uploader2.clearStoredFiles ();
                            }

                        },
                        onError: function (id, name, errorReason, xhrOrXdr) {
                            toastr.error(qq.format("Error on file number {} - {}.  Reason: {}", id, name, errorReason));
                        }

                    },
                    validation: {
                        allowedExtensions: allowedExt,
                        sizeLimit: 5120000
                    },
                    scaling: {
                        /*sizes: [
                         {name: "small", maxSize: 100},
                         {name: "medium", maxSize: 300}
                         ]*/
                    }

                });
                swal({
                        title              : TWIG.replaceMsg,
                        text               : TWIG.replaceMsg,
                        type               : "warning",
                        showCancelButton   : true,
                        confirmButtonColor : "#DD6B55",
                        confirmButtonText  : "Yes, replace it!",
                        closeOnConfirm     : false
                    },
                    function () {
                        swal.close();
                        $("#ReplaceModal"+type+idMedia).modal("show");

                    });

            });
            function getModalForImage(name, url, size, type, bucket, key, width, height, resize, thumbUrl, url1024,
                                      path, idMedia, action, typeModal){
              $.ajax({
                type: "POST",
                url: path,
                data: {
                    name     : name,
                    url      : url,
                    size     : size,
                    type     : type,
                    bucket   : bucket,
                    key      : key,
                    width    : width,
                    height   : height,
                    resize   : resize,
                    thumbUrl : thumbUrl,
                    url1024  : url1024,
                    idMedia  : idMedia
                },
            success: function (data) {
                s3Uploader.clearStoredFiles ();
                var d = new Date();
                toastr.success("file " + name + "successfully uploaded");
                    if(action === 'replace') {
                        $(".removeMedia-" + data.id).remove();
                        $("#ReplaceModal" + typeModal + idMedia).modal("hide");
                    }
                    var text = '<div class="file-box removeMedia-' + data.id + '"><div ' +
                        'class="file"><a href="#presentation-' + data.id + '" data-toggle="modal"' +
                        'data-target="#' + data.presentationModal + '-' + data.id + '">' +
                        '<span class="corner"></span>' +
                        '<div class="image thumbnail-img ' + data.className + '" data-id="' + data.id + '" data-url="' + data
                            .urlDisplay
                        +'?ver=' + d.getTime() +'">'+
                        '<img alt="image" class="img-thumbed" src="' + data.thumb_url + '?ver=' + d.getTime() +'">' +
                        '</div>' +
                        '</a><div class="file-name mediaMytitle" align="center"><a ' +
                        'href="#presentation-' + data.id + '" ' +
                        'data-toggle="modal" data-target="#' + data.presentationModal + '-' + data.id + '">' +
                        '<span></span><br>' +
                        '</a><a class="btn btn-white btn-pencil media-remove" data-type="img" data-flag="10" ' +
                        'data-href="' + data.urlRemove + '" data-id="' + data.id + '">' +
                        '<i class="fa fa-trash"></i></a>' +
                        '<a class="btn btn-white btn-bitbucket" data-toggle="modal" ' +
                        'data-target="#' + data.upPresModal + '-' + data.id + '" data-id="' + data
                            .id + '">' +
                        '<i class="fa fa-pencil"></i></a>' +
                        '<a class="btn btn-white btn-bitbucket ' + data.className + '" ' +
                        'data-toggle="modal" ' +
                        'data-target="#' + data.presentationModal + '-' + data.id + '" ' +
                        'data-url="' + data.urlDisplay + '?ver=' + d.getTime() +'" ' +
                        'data-id="' + data.id + '">' +
                        '<i class="fa fa-eye"></i></a></div></div></div>';


                    text += '<div class="modal inmodal" id="' + data.presentationModal + '-' + data.id + '"' +
                        'tabindex="-1" role="dialog" ' +
                        'aria-hidden="true"><div style="width: 70%;" class="modal-dialog">' +
                        '<div class="modal-content animated fadeIn">' +
                        '<div id="modal-medias" class="modal-header">' +
                        '<button type="button" class="close img-close" data-dismiss="modal"><span aria-hidden="true">&times;' +
                        '</span><span class="sr-only">Close</span></button>' +
                        '<div class="col-lg-9 border-right" id="object-' + data.id + '">' +
                        '<img width="100%" src="' + data.urlDisplay + '?ver=' + d.getTime() +'"></div>' +
                        '<div class="col-lg-4 " align="left" >' +
                        '<b>{{ 'media.detail' | trans({}, 'media') }}</b><br>' +
                        '<div class="title-large"> {{ 'media.detail_title' | trans({}, 'media') }}: ' + data.title + '</div><br>' +
                        '<span>{{ 'media.detail_format' | trans({}, 'media') }}: ' + data.type + '</span><br>' +
                        '<span>{{ 'media.detail_size' | trans({}, 'media') }}:  ' + data.size / 100000 + 'M ' +
                        '</span><br>';
                if(data.t === "img") {
                    text += '<span>{{ 'media.detail_resolution' | trans({}, 'media') }}: ' + data.width + '×' + data
                            .height + '</span><br>';
                }
                text += '<span> {{ 'media.detail_creation_date' | trans({}, 'media') }}: ' + data.created + '</span><br>' +
                        '<span>{{ 'media.detail_update_date' | trans({}, 'media') }}: ' + data.updated + '</span><br>' +
                        '<b>' + data.labelmedia + '</b>';
                    if(data.t === "img") {
                        text += '<br>' + data.height + 'x' + data.width + '</b>';
                    }
                    text += '</div></div></div></div></div>';

                    text += '<div class="modal inmodal" id="' + data.upPresModal + '-' + data.id + '" ' +
                        'tabindex="-1" role="dialog"  aria-hidden="true">' +
                        '<div class="modal-dialog">' +
                        '<div class="modal-content animated fadeIn">' +
                        '<div class="modal-header">' +
                        '<button type="button" class="close" data-dismiss="modal"><span ' +
                        'aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>' +
                        '<div class="col-lg-6 border-right" id="object-' + data.id + '">';
                        switch(data.t) {
                            case 'pdf':
                                text += '<object data="' + data.urlDisplay + '" type="application/pdf" '+
                                        'style="width: 100%; height: 400px;"></object>';
                                break;
                            case 'video':
                                text += '<video width="320" height="240" controls>'+
                                        '<source src="' + data.urlDisplay + '" type="video/mp4"></video>';
                                break;
                            case 'img':
                                text += '<img width="100%" src="' + data.urlDisplay + '?ver=' + d.getTime() +'">';
                                break;
                        }

                    text += '</div><div class="col-lg-6 " align="left">' +
                        '<form  method="post" action="' + data.urlUpdate + '" ' +
                        'enctype="multipart/form-data">' +
                        '<div class="form-group">' +
                        '<label for="fos_user_registration_form_firstname" class="required">{{ 'media.detail_title' | trans({}, 'media') }}</label>* :' +
                        '<input type="text" class="form-control" value="' + data.title + '" ' +
                        'name="title"/>' +
                        '</div><br><div class="form-group">' +
                        '<input type="submit"class="btn btn-success pull-right" value="Save" />' +
                        '<a type="submit" data-type="' + data.t + '" data-flag="' + data.flag + '" ' +
                        'data-id="' + data.id + '" style="background-color: rgb(190, 92, 73); ' +
                        'border-color:rgb(190, 92, 73)"' +
                        'data-key="' + key + '"'+
                        'class="media-replace btn btn-success">Replace Image</a>' +
                        '</div></form></div></div></div></div></div>';
                    text += '<div style="z-index: 999999999" class="modal inmodal" ' +
                        'id="ReplaceModal' + data.t + data.id + '" tabindex="-1" role="dialog"' +
                        'aria-hidden="true">' +
                        '<div class="modal-dialog">' +
                        '<div class="modal-content animated fadeIn"><div class="modal-header">' +
                        '<button type="button" class="close" data-dismiss="modal"><span ' +
                        'aria-hidden="true">&times;</span><span ' +
                        'class="sr-only">Close</span></button></div><div>' +
                        '<form  id="my-awesome-dropzone-img' + data.id + '" data-type="' + data
                            .contentType + '" class="dropzone upload-img" action="' + data.urlReplace + '"' +
                        'method="post" enctype="multipart/form-data">' +
                        '<div class="dropzone-previews"></div>' +
                        '</form></div></div></div></div>';

                    setTimeout(function(){ $(".fadeInRight").find(".col-lg-12").prepend(text);}, 3000);

            },
            error: function (xhr, ajaxOptions, thrownError) {
                toastr.error(thrownError);
            }
    });
              /*---------------------------------------------------------------------*/
            }
        </script>
    {% endblock %}
